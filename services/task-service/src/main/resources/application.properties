# ==============================================================
# TASK SERVICE - Configuração do Microsserviço
# ==============================================================

# Nome da aplicação
spring.application.name=task-service

# ==============================================================
# SERVIDOR
# ==============================================================
# Porta do servidor (diferente do monólito para evitar conflito)
server.port=8081

# ==============================================================
# BANCO DE DADOS H2
# ==============================================================
# URL do banco H2 em memória (isolado por serviço)
spring.datasource.url=jdbc:h2:mem:taskdb
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=

# ==============================================================
# JPA / HIBERNATE
# ==============================================================
# Dialeto do Hibernate para H2
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

# DDL auto: create-drop para desenvolvimento (recria schema a cada restart)
# Em produção, usar: validate ou flyway/liquibase
spring.jpa.hibernate.ddl-auto=create-drop

# Mostra SQL no console (útil para debug)
# SEGURANÇA: Desabilitar em produção para evitar vazamento de dados
spring.jpa.show-sql=${SQL_LOGS_ENABLED:true}
spring.jpa.properties.hibernate.format_sql=${SQL_LOGS_ENABLED:true}

# ==============================================================
# H2 CONSOLE (Acesso web ao banco)
# ==============================================================
# SEGURANÇA: Desabilitar em produção para prevenir exposição do banco
# Risco: CWE-200 (Information Exposure)
spring.h2.console.enabled=${H2_CONSOLE_ENABLED:true}
spring.h2.console.path=/h2-console
# Permitir acesso apenas de localhost
spring.h2.console.settings.web-allow-others=false

# ==============================================================
# LOGGING
# ==============================================================
# Nível de log para o serviço
logging.level.com.example.taskservice=${LOG_LEVEL:INFO}
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=${SQL_LOG_LEVEL:DEBUG}

# SEGURANÇA: Padrão de logs (oculta dados sensíveis)
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n

# ==============================================================
# SEGURANÇA
# ==============================================================
# Headers de segurança HTTP
server.error.include-message=never
server.error.include-binding-errors=never
server.error.include-stacktrace=never
server.error.include-exception=false

# CORS - Configurar origens permitidas via variável de ambiente
# IMPORTANTE: Nunca usar "*" em produção
app.cors.allowed-origins=${CORS_ORIGINS:http://localhost:3000}

# Limita tamanho de requisições (previne ataques de exaustão)
spring.servlet.multipart.max-file-size=1MB
spring.servlet.multipart.max-request-size=10MB

# ==============================================================
# PERFIS (Separar configurações dev/prod)
# ==============================================================
spring.profiles.active=${SPRING_PROFILE:dev}

# ==============================================================
# ACTUATOR (Métricas e Health Check)
# ==============================================================
# Habilita todos os endpoints do actuator
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always

# Porta do actuator (mesma da aplicação)
management.server.port=8081
